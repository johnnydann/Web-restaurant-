@model X.PagedList.PagedList<ChieuT4_Nhom05_WebQLCF.Models.Product>
@using X.PagedList.Mvc.Core;
<link href="~/css/productstyle.css" rel="stylesheet" />

<section class="hero-section position-relative jarallax">
    <img src="~/images/banner_shop.jpg" alt="tea cup" class="jarallax-img">
    <div class="hero-content position-absolute d-flex justify-content-center align-items-center text-center">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1 class="page-title text-light fst-italic">Shop</h1>
                    <div class="breadcrumbs text-light">
                        <span class="item">
                            <a asp-area="" asp-controller="Home" asp-action="Index" class="text-light">Home /</a>
                        </span>
                        <span class="item">Shop</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="container-lg">
    <div class="row" id="productList">
        <!-- Product items will be displayed here -->
    </div>
    @* <nav class="navigation paging-navigation text-center padding-medium" role="navigation">
        <div class="pagination loop-pagination d-flex justify-content-center align-items-center">
            @Html.PagedListPager(Model, page => Url.Action("Index", new { page }), PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(new PagedListRenderOptions { DisplayLinkToFirstPage = PagedListDisplayMode.Never, DisplayLinkToLastPage = PagedListDisplayMode.Never, LinkToPreviousPageFormat = "<a href=\"#\"><svg class=\"chevron-left pe-3\"><use xlink:href=\"#chevron-left\"></use></svg></a>", LinkToNextPageFormat = "<a href=\"#\"><svg class=\"chevron-right ps-3\"><use xlink:href=\"#chevron-right\"></use></svg></a>" }))
        </div>
    </nav> *@
</div>

@section Scripts {
    <script>
        async function fetchProductData() {
            try {
                const response = await fetch('http://localhost:5241/api/ProductApi/getall');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const products = await response.json();

                // Kiểm tra xem dữ liệu nhận được từ API có phải là một mảng hay không
                if (!Array.isArray(products)) {
                    console.error('Error: Products data is not an array');
                    return;
                }

                displayProductList(products);
            } catch (error) {
                console.error('Error fetching product data:', error);
            }
        }

        function displayProductList(products) {
            const productListDiv = document.getElementById('productList');
            productListDiv.innerHTML = '';

            // Kiểm tra xem products có phải là mảng hay không
            if (!Array.isArray(products)) {
                console.error('Error: Products data is not an array');
                return;
            }

            if (products.length === 0) {
                productListDiv.innerHTML = '<p>No products found.</p>';
                return;
            }

            products.forEach(product => {
                const productItem = document.createElement('div');
                productItem.classList.add('col-lg-3', 'col-md-6', 'mb-5');
                productItem.innerHTML = `
                            <div class="product-item mx-auto shadow rounded bg-light">
                                <div class="image-holder mb-3">
                                    <img src="${product.imageUrl}" alt="${product.name}" class="img-fluid rounded" style="width: 100%; height: 200px; object-fit: cover">
                                    <div class="overlay">
                                        <a href="/Customer/Home/GetProductById/id=${product.id}" class="btn btn-primary">Details</a>
                                    </div>
                                </div>
                                <div class="product-info text-center">
                                    <h3 class="product-title">
                                        <a href="/Customer/Home/GetProductById/id=${product.id}" class="text-dark">${product.name}</a>
                                    </h3>
                                    <div class="product-price text-primary">${product.price}</div>
                                    <form id="addToCartForm_${product.id}" data-product-id="${product.id}" class="add-to-cart-form" action="/ShoppingCart/AddToCart" method="post">
                                        <input type="hidden" name="productId" value="${product.id}" />
                                        <input type="hidden" name="quantity" value="1" />
                                        <button type="submit" class="btn btn-outline-dark add-to-cart-btn">
                                            <i class="bi-cart-fill me-1"></i> Add to cart
                                        </button>
                                    </form>
                                </div>
                            </div>`;
                productListDiv.appendChild(productItem);
            });
        }

        window.addEventListener('load', () => {
            fetchProductData();
        });

        $(document).on('submit', '.add-to-cart-form', function (e) {
            e.preventDefault();

            var form = $(this);
            var formData = form.serialize();

            $.ajax({
                url: form.attr('action'),
                method: form.attr('method'),
                data: formData,
                success: function (response) {
                    console.log('Product added to cart successfully!');

                    Toastify({
                        text: "Product added to cart successfully!",
                        duration: 3000,
                        close: true,
                        gravity: "bottom",
                        position: "right",
                        backgroundColor: "linear-gradient(to right, #28a745, #218838)",
                    }).showToast();
                },
                error: function (xhr, status, error) {
                    console.error('Error adding product to cart:', error);
                }
            });
        });
    </script>
}
